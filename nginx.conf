server {
  listen 80;
  server_name localhost;
 
  root /usr/share/nginx/html;

  # Strip trailing slashes — Next.js uses trailingSlash: false,
  # so /zh/ should redirect to /zh (which resolves to zh.html).
  # Without this, nginx tries to serve the directory and returns 403.
  location ~ ^(.+)/$ {
      return 301 $1;
  }

  # Static assets with content hash — long cache (1 year)
  location /_next/static/ {
      add_header Cache-Control "public, max-age=31536000, immutable";
      try_files $uri =404;
  }

  # Image assets — 1 day cache
  location /images/ {
      add_header Cache-Control "public, max-age=86400, stale-while-revalidate=604800";
      try_files $uri =404;
  }

  # Fonts — long cache
  location /fonts/ {
      add_header Cache-Control "public, max-age=31536000, immutable";
      try_files $uri =404;
  }
 
  # HTML pages — 1 hour cache
  location / {
      add_header Cache-Control "public, max-age=3600, stale-while-revalidate=86400";
      try_files $uri $uri.html $uri/ =404;
  }
 
  # This is necessary when `trailingSlash: false`.
  # You can omit this when `trailingSlash: true`.
  location /blog/ {
      add_header Cache-Control "public, max-age=3600, stale-while-revalidate=86400";
      rewrite ^/blog/(.*)$ /blog/$1.html break;
  }
 
  error_page 404 /404.html;
  location = /404.html {
      internal;
  }
}